<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì˜</title>
</head>
<body>
<menu th:replace="fragments/head :: menu"></menu>
    <main>
        <div class="container">
            <h1 class="mb-4 text-center">ğŸ¾ ê³ ê°ì„¼í„° ğŸ¾</h1>
            <h3 class="mb-4 text-center">ê³ ë¯¼ ìˆìœ¼ë©´ ì—¬ê¸°ë‹¤ ì–˜ê¸°í•˜ê°œ ğŸ¶</h3>
        <div class="row align-items-end">
            <div class="col">
                <label for="category" class="form-label">ì¹´í…Œê³ ë¦¬</label>
                <select class="form-select" id="category">
                    <option selected value="" >ì „ì²´</option>
                </select>
            </div>
            <div class="col">
                <label for="result" class="form-label">ê²°ê³¼</label>
                <select class="form-select" id="result">
                    <option value="" selected>ì „ì²´</option>
                    <option value="N">ëŒ€ê¸°</option>
                    <option value="S">ì—´ëŒ</option>
                    <option value="Y">ì™„ë£Œ</option>
                </select>
            </div>
            <div class="col">
                <label for="title" class="form-label">ì œëª©</label>
                <input type="text" id="title" class="form-control">
            </div>
            <div class="col">
                <br>
                <button type="button" class="btn btn-primary" id="searchBtn">ê²€ìƒ‰</button>
            </div>
            </div>
            <div>
                <table class="table table-hover" id="tableDiv">
                </table>
            </div>
            <div class="d-flex justify-content-center">
                <nav aria-label="Page navigation example">
                    <ul class="pagination" id="pagination">
                    </ul>
                </nav>
            </div>
        </div>
    </main>
<!--ìŠ¤í¬ë¦½íŠ¸-->
<script src="/js/help/function.js"></script>
<script src="/js/help/page.js"></script>
<script>
    $(document).ready(function() {
        getList(1);
        // ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° Start
        $.ajax({
            type : "GET",
            url : "/help/getCategory",
            dataType : "json",
            success : function(result) {
                for (var i = 0 ; i < result.length; i++) {
                    let htmlStr = `
                            <option value='`+result[i].helpCategoryCode+`'>`+result[i].categoryName+`</option>
                        `;
                    $('#category').append(htmlStr);
                }
            }
        });
        // ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° End

    });
    // list ë¶ˆëŸ¬ì˜¤ê¸° Start
    function getList(nowPage,searchMap) {
        $('#tableDiv').html('');

        // ì…ë ¥ í•„ë“œì™€ ì…€ë ‰íŠ¸ë°•ìŠ¤ì—ì„œ ê°’ì„ ê°€ì ¸ì˜´
        let titleValue = $('#title').val();
        let categoryValue = $('#category').val();
        let resultValue = $('#result').val();

        // ë§µê³¼ ìœ ì‚¬í•œ êµ¬ì¡°ë¡œ ë°ì´í„°ë¥¼ ìƒì„±
        let dataMap = {
            title: titleValue,
            category: categoryValue,
            result: resultValue,
            nowPage: nowPage
        };

        // ì¿¼ë¦¬ ë¬¸ìì—´ ìƒì„±
        let queryString = $.param(dataMap);

        $.ajax({
            type : "GET",
            url : "/help/inquiry/getList?"+queryString,
            dataType : "json",
            success : function(result) {
                console.log(result);
                let template = '';
                let resultStr = 'ëŒ€ê¸°';
                let resultStateClass = "bg-secondary";
                template = `
                        <thead>
                            <tr>
                                <th scope="col">ìƒì„± ë‚ ì§œ</th>
                                <th scope="col">ì œëª©</th>
                                <th scope="col">ê²°ê³¼</th>
                            </tr>
                        </thead>
                    `;
                for (var i = 0; i < result.viewAll.length; i++) {
                    if (result.viewAll[i].result == 'S') {
                        resultStr = 'ì—´ëŒ';
                        resultStateClass = "bg-primary";
                    } else if (result.viewAll[i].result == 'Y') {
                        resultStr = 'ì™„ë£Œ';
                        resultStateClass = "bg-success";
                    } else if (result.viewAll[i].result == 'N') {
                        resultStr = 'ëŒ€ê¸°';
                        resultStateClass = "bg-secondary";
                    }
                    template += `
                            <tbody>
                                <tr class="listRow" data-inquiryNo="`+result.viewAll[i].inquiryNo+`">
                                    <td>`+dataFormat1(result.viewAll[i].createDate)+`</td>
                                    <td>`+result.viewAll[i].title+`</td>
                                    <td><span class="badge rounded-pill `+resultStateClass+`">`+resultStr+`</span></td>
                                </tr>
                            </tbody>
                        `;
                }
                getpaging(result);
                $('#tableDiv').append(template);
            }
        });
    }
    // list ë¶ˆëŸ¬ì˜¤ê¸° End
    // ê²€ìƒ‰ click ì´ë²¤íŠ¸ Start
        $("#searchBtn").click(function(){
            getList(1);
        });
    // ê²€ìƒ‰ click ì´ë²¤íŠ¸ End
    // ê¸€ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ Start
    $("#tableDiv").on("click",".listRow",function(){
        let inquiryNo = $(this).attr('data-inquiryno');
        location.href='/help/inquiry/detail?inquiryNo='+inquiryNo;
    });
    // ê¸€ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ End
</script>
</body>
</html>