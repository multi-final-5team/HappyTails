<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head">
<head>
    <meta charset="UTF-8">
    <title>문의</title>
</head>
<body>
<menu th:replace="fragments/head :: menu"></menu>
    <div class="container">
        <figure class="text-center">
            <h2>고객센터</h2>
        </figure>
        <figure class="text-left">
            <h3>1:1 문의 리스트</h3>
        </figure>
        <main>
            <div class="row">
                <div class="col">
                    <label for="category" class="form-label">카테고리</label>
                    <select class="form-select" id="category">
                        <option selected value="" >전체</option>
                    </select>
                </div>
                <div class="col">
                    <label for="result" class="form-label">결과</label>
                    <select class="form-select" id="result">
                        <option value="" selected>전체</option>
                        <option value="N">대기</option>
                        <option value="S">열람</option>
                        <option value="Y">완료</option>
                    </select>
                </div>
                <div class="col">
                    <label for="title" class="form-label">제목</label>
                    <input type="text" id="title" class="form-control">
                </div>
                <div class="col">
                    <br>
                    <button type="button" class="btn btn-primary" id="searchBtn">검색</button>
                </div>
            </div>
            <div>
                <table class="table table-hover" id="tableDiv">
                </table>
            </div>
            <div>
                <nav aria-label="Page navigation example">
                    <ul class="pagination" id="pagination">
                    </ul>
                </nav>
            </div>
        </main>
    </div>
<!--스크립트-->
<script src="/js/help/function.js"></script>
<script src="/js/help/page.js"></script>
<script>
    $(document).ready(function() {
        getList(1);
        // 카테고리 불러오기 Start
        $.ajax({
            type : "GET",
            url : "/help/getCategory",
            dataType : "json",
            success : function(result) {
                for (var i = 0 ; i < result.length; i++) {
                    let htmlStr = `
                            <option value='`+result[i].helpCategoryCode+`'>`+result[i].categoryName+`</option>
                        `;
                    $('#category').append(htmlStr);
                }
            }
        });
        // 카테고리 불러오기 End

    });
    // list 불러오기 Start
    function getList(nowPage,searchMap) {
        $('#tableDiv').html('');

        // 입력 필드와 셀렉트박스에서 값을 가져옴
        let titleValue = $('#title').val();
        let categoryValue = $('#category').val();
        let resultValue = $('#result').val();

        // 맵과 유사한 구조로 데이터를 생성
        let dataMap = {
            title: titleValue,
            category: categoryValue,
            result: resultValue,
            nowPage: nowPage
        };

        // 쿼리 문자열 생성
        let queryString = $.param(dataMap);

        $.ajax({
            type : "GET",
            url : "/help/inquiry/getList?"+queryString,
            dataType : "json",
            success : function(result) {
                console.log(result);
                let template = '';
                let resultStr = '대기';
                let resultStateClass = "bg-secondary";
                template = `
                        <thead>
                            <tr>
                                <th scope="col">생성 날짜</th>
                                <th scope="col">제목</th>
                                <th scope="col">결과</th>
                            </tr>
                        </thead>
                    `;
                for (var i = 0; i < result.viewAll.length; i++) {
                    if (result.viewAll[i].result == 'S') {
                        resultStr = '열람';
                        let resultStateClass = "bg-primary";
                    } else if (result.viewAll[i].result == 'Y') {
                        resultStr = '완료';
                        let resultStateClass = "bg-success";
                    }
                    template += `
                                    <tbody>
                                        <a href="/help/inquiry/detail">
                                            <tr>
                                                <td>`+dataFormat1(result.viewAll[i].createDate)+`</td>
                                                <td>`+result.viewAll[i].title+`</td>
                                                <td><span class="badge rounded-pill `+resultStateClass+`">`+resultStr+`</span></td>
                                            </tr>
                                        </a>
                                    </tbody>
                                `;
                }
                getpaging(result);
                $('#tableDiv').append(template);
            }


        });
    }
    // list 불러오기 End
    // 검색 click 이벤트 Start
        $("#searchBtn").click(function(){
            getList(1);
        });
    // 검색 click 이벤트 End

</script>
</body>
</html>