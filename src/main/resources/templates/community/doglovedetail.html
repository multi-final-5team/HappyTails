<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>게시글 상세</title>
</head>

<script>
    function addReply(event) {
        event.preventDefault();  // 폼의 기본 제출 동작을 막습니다.

        const dogloveNo = document.querySelector("input[name='replyNo']").value;
        const content = document.querySelector("textarea[name='content']").value;

        fetch(`/doglove/${dogloveNo}/reply/add`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ content }),
        })
        .then(response => response.text())
        .then(data => {
            alert(data);
            // 댓글 추가 후 페이지를 다시 로드하거나, 댓글 목록을 갱신하는 로직을 추가합니다.
            location.reload();
        })
        .catch(error => console.error('Error:', error));
    }
</script>

<body>
<h1>게시글 상세</h1>
<div>
    <h2 th:text="${doglove.title}"></h2>
    <p><strong>작성자:</strong> <span th:text="${doglove.userId}"></span></p>
    <p><strong>작성 시간:</strong> <span th:text="${#temporals.format(doglove.createTime, 'yyyy-MM-dd HH:mm:ss')}"></span></p>
    <p><strong>추천 수:</strong> <span th:id="recommendCount" th:text="${doglove.recommendCount}"></span></p>

    <p th:text="${doglove.content}"></p>
</div>

<div>
    <h3>댓글</h3>
    <form onsubmit="addReply(event)">
        <!-- 댓글 작성 폼 -->
        <input type="hidden" name="replyNo" th:value="${doglove.dogloveNo}" />
        <label for="content">댓글 내용:</label>
        <textarea id="content" name="content" rows="3" required></textarea>

        <button type="submit">댓글 작성</button>
    </form>

    <!-- 댓글 목록 -->
    <ul>
        <li th:each="reply : ${replies}">
            <p>
                <strong th:text="${reply.writerId}">작성자</strong>: <!-- 댓글 작성자 이름 -->
                <span th:text="${reply.content}">댓글 내용</span>
                <small th:text="${#temporals.format(reply.createDate, 'yyyy-MM-dd HH:mm:ss')}">날짜</small>
            </p>
        </li>
    </ul>
</div>

<a href="/community/doglove">목록으로 돌아가기</a>
<a href="/community/doglove/create">새 글 작성하기</a>

</body>
</html>
