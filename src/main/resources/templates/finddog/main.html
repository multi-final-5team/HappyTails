<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head">
    <meta charset="UTF-8">
    <title>ì°¾ì•„ì£¼ê°œ</title>
</head>
<body>
<menu th:replace="fragments/head :: menu"></menu>
<main>
    <div class="container">
        <h1 class="mb-4 text-center">ğŸ¾ ì°¾ì•„ì£¼ê°œ ğŸ¾</h1>
        <h3 class="mb-4 text-center">ìƒì–´ë²„ë¦° ë°˜ë ¤ê²¬, í•¨ê»˜ ì°¾ìŠµë‹ˆë‹¤. ğŸ¶</h3>
        <div style="margin-left: 215px;">
            <div class="row">
                <div class="list-group flex-row col-3" id="list-tab" role="tablist">
                    <a class="border border-secondary list-group-item list-group-item-action active" data-bs-toggle="list" href="#list-find" role="tab" aria-controls="list-find" id="tab1">ìƒì–´ë²„ë¦° ê°•ì•„ì§€</a>
                    <a class="border border-secondary list-group-item list-group-item-action" data-bs-toggle="list" href="#list-misgiving" role="tab" aria-controls="list-misgiving" id="tab2">ìœ ê¸° ì˜ì‹¬ ê³µìœ </a>
                </div>
            </div>
            <div class="row align-items-end">
                <div class="col">
                    <label for="state" class="form-label">ìƒíƒœ</label>
                    <select class="form-select" id="state">
                        <option value="" selected>ì „ì²´</option>
                        <option value="N">ë¯¸í•´ê²°</option>
                        <option value="Y">í•´ê²°</option>
                    </select>
                </div>
                <div class="col">
                    <label for="area" class="form-label">ì¥ì†Œ</label>
                    <input type="text" id="area" class="form-control">
                </div>
                <div class="col">
                    <label for="title" class="form-label">ì œëª©</label>
                    <input type="text" id="title" class="form-control">
                </div>
                <div class="col">
                    <br>
                    <button type="button" class="btn btn-primary" id="searchBtn">ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="col-9 mt-3 tab-content">
                <div class="tab-pane fade show active" id="list-find">
                    <h3>ìƒì–´ë²„ë¦°ê°•ì•„ì§€ ë¦¬ìŠ¤íŠ¸</h3>
                    <div class="row" id="findListDiv">

                    </div>
                </div>
                <div class="tab-pane fade" id="list-misgiving">
                    <h3>ìœ ê¸°ì˜ì‹¬ê³µìœ  ë¦¬ìŠ¤íŠ¸</h3>
                    <div class="row" id="misgivingListDiv">

                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination" id="pagination">
                        </ul>
                    </nav>
                </div>
                <div>
                    <input type="button" class="btn btn-primary" value="ê¸€ì“°ê¸°" style="" id="writePageBtn"/>
                </div>
            </div>
        </div>
    </div>
</main>
<menu th:replace="fragments/head :: footer"></menu>
<!-- ìŠ¤í¬ë¦½íŠ¸ -->
<script src="/js/help/function.js"></script>
<script src="/js/help/page.js"></script>
<script>

    let listSwtich = 0;

    $(document).ready(function(){

        getList(1);

        // ê¸€ì“°ê¸° í˜ì´ì§€ ì´ë™ ë²„íŠ¼ Start
        $("#writePageBtn").click(function(){
            location.href="/finddog/write";
        });
        // ê¸€ì“°ê¸° í˜ì´ì§€ ì´ë™ ë²„íŠ¼ End

        // ìƒì–´ë²„ë¦° ê°•ì•„ì§€ íƒ­ í´ë¦­ ì‹œ Start
        $('#tab1').click(function(){
            listSwtich = 0;
            $('#state').val('');
            $('#title').val('');
            $('#area').val('');
            getList(1);
        });
        // ìƒì–´ë²„ë¦° ê°•ì•„ì§€ íƒ­ í´ë¦­ ì‹œ End

        // ìœ ê¸°ì˜ì‹¬ê³µìœ  íƒ­ í´ë¦­ ì‹œ Start
        $('#tab2').click(function(){
            listSwtich = 1;
            $('#state').val('');
            $('#title').val('');
            $('#area').val('');
            getList(1);
        });
        // ìœ ê¸°ì˜ì‹¬ê³µìœ  íƒ­ í´ë¦­ ì‹œ End
    });

    // list ë¶ˆëŸ¬ì˜¤ê¸° Start
    function getList(nowPage,searchMap) {
        $('#misgivingListDiv').html('');
        $('#findListDiv').html('');

        // ì…ë ¥ í•„ë“œì™€ ì…€ë ‰íŠ¸ë°•ìŠ¤ì—ì„œ ê°’ì„ ê°€ì ¸ì˜´
        let titleValue = $('#title').val();
        let categoryValue = 'F';

        if (listSwtich == 0) {
            categoryValue = 'F';
        } else {
            categoryValue = 'M';
        }

        let stateValue = $('#state').val();
        let areaValue = $('#area').val();

        // ë§µê³¼ ìœ ì‚¬í•œ êµ¬ì¡°ë¡œ ë°ì´í„°ë¥¼ ìƒì„±
        let dataMap = {
            title: titleValue,
            category: categoryValue,
            state: stateValue,
            area: areaValue,
            nowPage: nowPage
        };

        // ì¿¼ë¦¬ ë¬¸ìì—´ ìƒì„±
        let queryString = $.param(dataMap);

        $.ajax({
            type : "GET",
            url : "/finddog/getList?"+queryString,
            dataType : "json",
            success : function(result) {
                console.log(result);
                let template = '';
                let stateStr = 'ë¯¸í•´ê²°';
                let stateClass = "bg-secondary";
                for (var i = 0; i < result.viewAll.length; i++) {
                    if (result.viewAll[i].state == 'Y') {
                        stateStr = 'í•´ê²°';
                        stateClass = "bg-success";
                    }
                    template += `
                        <div class="col-md-4 mb-4 d-flex align-items-stretch listRow" data-find-dog-no="`+result.viewAll[i].findDogNo+`">
                            <div class="card" style="width: 100%;">
                                <img src="/images/F/`+result.imageMap[result.viewAll[i].findDogNo]+`" class="card-img-top" onerror="this.onerror=null; this.src='https://kr.object.ncloudstorage.com/team-5/Non-Img.png';" width="300" height="200">
                                <div class="card-body">
                                    <h5 class="card-title">`+result.viewAll[i].title+`</h5>
                                    <p class="card-text">ì¥ì†Œ: `+result.viewAll[i].area+`</p>
                                    <p><span class="badge rounded-pill `+stateClass+`">`+stateStr+`</span></p>
                                </div>
                            </div>
                        </div>
                        `;
                }
                getpaging(result);
                if (listSwtich == 0) {
                    $('#findListDiv').append(template);
                } else {
                    $('#misgivingListDiv').append(template);
                }
            }
        });
    }
    // list ë¶ˆëŸ¬ì˜¤ê¸° End
    // ê²€ìƒ‰ click ì´ë²¤íŠ¸ Start
    $("#searchBtn").click(function(){
        getList(1);
    });
    // ê²€ìƒ‰ click ì´ë²¤íŠ¸ End

    // ê¸€ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ Start
    $("#findListDiv").on("click",".listRow",function(){
        let findDogNo = $(this).attr('data-find-dog-no');
        console.log(findDogNo);
        location.href='/finddog/detail?findDogNo='+findDogNo;
    });
    // ê¸€ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ End

    // ê¸€ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ Start
    $("#misgivingListDiv").on("click",".listRow",function(){
        let findDogNo = $(this).attr('data-find-dog-no');
        location.href='/finddog/detail?findDogNo='+findDogNo;
    });
    // ê¸€ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™ End

</script>
</body>
</html>