<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>카카오 로그인</title>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script>
        Kakao.init('00f8ce605055d2ddbe1b0ee7359a0e6f');
        console.log(Kakao.isInitialized());

        function kakaoLogin() {
            Kakao.Auth.login({
                success: function (response) {
                    Kakao.API.request({
                        url: '/v2/user/me',
                        success: function (response) {
                            console.log(response);
                            // 서버로 데이터 전송
                            sendToServer(response);
                        },
                        fail: function (error) {
                            console.log(error);
                        },
                    })
                },
                fail: function (error) {
                    console.log(error);
                },
            })
        }

        function sendToServer(kakaoData) {
            fetch('/member/kakaoLogin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: kakaoData.id,
                    nickname: kakaoData.properties.nickname,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    // 로그인 성공 후 리다이렉트
                    window.location.href = '/member/memberinfo';
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        // 페이지 로드 시 즉시 kakaoLogin 함수 실행
        window.onload = kakaoLogin;
    </script>
</head>
<body>
    <h1>카카오 로그인 처리 중...</h1>
    <p>잠시만 기다려주세요.</p>
</body>
</html>