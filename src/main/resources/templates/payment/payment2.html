<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}">
    <title>결제하기</title>
</head>
<body>
<menu th:replace="fragments/head :: menu"></menu>
<div class="container">
    <div class="main-content">
        <div class="left-section">
            <h2>주문/결제</h2>
            <form id="orderForm">
                <div class="form-group">
                    <label for="name">구매자 성함</label>
                    <input type="text" id="name" name="name" th:value="${memberDTO.id}" required>
                </div>
                <div class="form-group">
                    <label for="phone">연락처</label>
                    <input type="tel" id="phone" name="phone" th:value="${memberDTO.tel}" required>
                </div>
                <div class="form-group">
                    <label for="address">배송지 주소</label>
                    <input type="text" id="address" name="address" required>
                </div>
                <div class="form-group">
                    <label for="delivery_request">배송시 요청사항</label>
                    <input type="text" id="delivery_request" name="delivery_request" required>
                </div>
            </form>
        </div>
        <h1 class="mb-4 text-center">장바구니 상품 목록</h1>
        <div class="card shadow">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                        <tr>
                            <th>상품명</th>
                            <th>가격</th>
                            <th>수량</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="cartList : ${cartList}">
                            <td>
                                <a th:href="@{/sales/selectGoods(no=${cartList.goodsNo})}"
                                   th:text="${cartList.goodsName}"
                                   class="text-decoration-none"></a>
                            </td>
                            <td th:text="${#numbers.formatCurrency(cartList.price)}" class="price"></td>
                            <td th:text="${cartList.purchaseQuantity}" class="purchaseQuantity"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="price-info">

        <div class="price-row total-price">
            <span>총 결제금액</span>
            <p th:text="${#numbers.formatCurrency(#aggregates.sum(cartList.![price * purchaseQuantity]))} + '원'" id="amount"></p>
        </div>
        <button class="order-button" onclick="mypayment()">결제하기</button>
    </div>
</div>

<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
<!-- jQuery 라이브러리 로드 -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<!-- 포트원(구 아임포트) 결제 라이브러리 로드 -->
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
<!-- Axios HTTP 클라이언트 라이브러리 로드 -->
<script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
<!-- 최신 버전의 jQuery 라이브러리 로드 (보안 무결성 검사 포함) -->

<script src="/js/payment/payment.js"></script>

<script th:inline="javascript">
    // Thymeleaf를 통해 cartList 데이터를 JavaScript로 전달
    var originalPrice = /*[[${#aggregates.sum(cartList.![price * purchaseQuantity])}]]*/ 0;

</script>
</body>
<footer th:replace="fragments/head :: footer"></footer>
</html>