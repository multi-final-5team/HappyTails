<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>송장 정보 입력</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="card">
    <div class="card-body">
        <h3 class="card-title">송장 정보 입력</h3>
        <form id="insertForm">
            <input type="hidden" id="payment_no" name="payment_no" th:value="${payment_no}">

            <div class="mb-3">
                <label for="delivery_man" class="form-label">배달원 이름</label>
                <input type="text" class="form-control" id="delivery_man" name="delivery_man" required>
            </div>

            <div class="mb-3">
                <label for="invoice_number" class="form-label">송장 번호 입력</label>
                <input type="number" class="form-control" id="invoice_number" name="invoice_number" required min="0">
                <small class="form-text text-muted">숫자만 입력 가능합니다.</small>
            </div>

            <button type="submit" class="btn btn-primary">송장 정보 등록</button>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function() {
        $('#insertForm').submit(function(event){
            event.preventDefault();
            let formData = new FormData();

            formData.append('delivery_man', $('#delivery_man').val());
            formData.append('invoice_number', $('#invoice_number').val());
            formData.append('payment_no', $('#payment_no').val());

            $.ajax({
                url : "/payment/insertDelivery",
                processData : false,
                contentType : false,
                type : 'POST',
                data : formData,
                success : function(data) {
                    alert(data);  // 서버에서 반환한 메시지를 표시
                    if (window.opener) {
                        window.opener.location.reload();
                    }
                    window.close();
                },
                error: function(xhr, status, error) {
                    alert('송장 번호 등록에 실패했습니다. 다시 시도해주세요.');
                    console.error(xhr.responseText);
                }
            });
        });

        // 송장 번호 입력 필드에 숫자만 입력 가능하도록 제한
        $('#invoice_number').on('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    });
</script>
</body>
</html>